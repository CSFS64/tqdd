<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>招募申请</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --bg:#121212;--card:#1b1b1b;--line:#2a2a2a;--fg:#f5f5f5;--muted:#bdbdbd;
      --primary:#2b68ff;--primary-hover:#1f55d8;--accent:#ffdd57;--danger:#ff6464;--success:#4caf50;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans SC","PingFang SC","Microsoft Yahei",sans-serif;background:var(--bg);color:var(--fg);padding:2rem 1rem;}
    .container{max-width:720px;margin:0 auto}
    h1{margin:0 0 1rem;text-align:center;font-size:1.75rem}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:1.25rem;}
    .form{display:flex;flex-direction:column;gap:1rem;}
    .row{display:flex;flex-direction:column;gap:.5rem}
    label{font-weight:600;color:var(--accent)}
    input,select,textarea{
      width:100%;padding:.65rem .75rem;font-size:1rem;border-radius:8px;border:1px solid #3a3a3a;background:#101010;color:var(--fg);outline:none;
    }
    .inline-group{display:flex;gap:.75rem;flex-wrap:wrap;align-items:center}
    .inline-group label{color:var(--fg);font-weight:500}
    .hint{color:var(--muted);font-size:.9rem}
    .btn{appearance:none;border:0;border-radius:10px;padding:.75rem 1.1rem;cursor:pointer;background:var(--primary);color:#fff;font-weight:700;font-size:1rem;}
    .btn:hover{background:var(--primary-hover)}
    .msg{margin-top:.5rem;font-size:.95rem}
    .msg--error{color:var(--danger)}
    .msg--ok{color:var(--success)}
    .required{color:var(--accent);font-weight:700}
  </style>
</head>
<body>
  <div class="container">
    <h1>招募申请</h1>
    <div class="card">
      <form id="recruitForm" class="form" novalidate>
        <div class="row">
          <label for="nickname">游戏昵称 <span class="required">(必填)</span></label>
          <input id="nickname" name="nickname" placeholder="请输入游戏昵称" required />
        </div>

        <div class="row">
          <label for="contact">联系方式（QQ/微信） <span class="required">(必填)</span></label>
          <input id="contact" name="contact" placeholder="请输入联系方式" required />
        </div>

        <div class="row">
          <label for="survival">生存等级（1-100） <span class="required">(必填)</span></label>
          <input id="survival" name="survival" type="number" inputmode="numeric" min="1" max="100" placeholder="如 73" required />
        </div>

        <div class="row">
          <label>在线日（可多选） <span class="required">(必填)</span></label>
          <div class="inline-group" id="daysWrap">
            <label><input type="checkbox" name="days" value="weekday"> 工作日</label>
            <label><input type="checkbox" name="days" value="weekend"> 周末</label>
          </div>
          <div class="hint">两者都选表示工作日与周末均在线。</div>
        </div>

        <div class="row">
          <label for="hours">每天在线时长（小时） <span class="required">(必填)</span></label>
          <input id="hours" name="hours" type="number" inputmode="numeric" min="0" max="24" step="0.5" placeholder="如 2 或 3.5" required />
        </div>

        <div class="row">
          <label for="build">建筑分（数字） <span class="required">(必填)</span></label>
          <input id="build" name="build" type="number" inputmode="numeric" min="0" step="1" placeholder="如 26800" required />
        </div>

        <div class="row">
          <label for="note">备注 / 自我介绍（可选）</label>
          <textarea id="note" name="note" rows="4" placeholder="介绍下你的特长、上线习惯等"></textarea>
        </div>

        <div class="row">
          <button class="btn" id="submitBtn" type="submit">提交申请</button>
          <span id="msg" class="msg" aria-live="polite" hidden></span>
        </div>
      </form>
    </div>
  </div>

  <script>
    const ENDPOINT = '/api/recruit/submit';

    function getCheckedValues(name){
      return Array.from(document.querySelectorAll('input[name="'+name+'"]:checked')).map(x=>x.value);
    }
    function show(el, ok=true){ el.hidden = !ok; }
    function setText(el, html=false, content=''){ html ? (el.innerHTML = content) : (el.textContent = content); }

    document.getElementById('recruitForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const msg = document.getElementById('msg');
      const btn = document.getElementById('submitBtn');
      show(msg,false);

      // 校验
      const nickname = document.getElementById('nickname').value.trim();
      const contact  = document.getElementById('contact').value.trim();
      const survival = Number(document.getElementById('survival').value);
      const days     = getCheckedValues('days');
      const hours    = Number(document.getElementById('hours').value);
      const build    = Number(document.getElementById('build').value);
      const note     = document.getElementById('note').value.trim();

      if (!nickname || !contact || !survival || days.length===0 || isNaN(hours) || isNaN(build)) {
        setText(msg,false,'请填写所有必填字段'); msg.className='msg msg--error'; show(msg,true); return;
      }
      if (survival < 1 || survival > 100) {
        setText(msg,false,'生存等级需在 1-100 之间'); msg.className='msg msg--error'; show(msg,true); return;
      }
      if (hours < 0 || hours > 24) {
        setText(msg,false,'每天在线时长需在 0-24 小时之间'); msg.className='msg msg--error'; show(msg,true); return;
      }
      if (build < 0) {
        setText(msg,false,'建筑分需为非负数字'); msg.className='msg msg--error'; show(msg,true); return;
      }

      const data = {
        nickname, contact,
        survival: Math.round(survival),
        days: days.join(','),   // 与后端 splitCSV 对齐
        hours,
        build: Math.round(build),
        note
      };

      try{
        btn.disabled = true;
        setText(msg,false,'提交中…'); msg.className='msg'; show(msg,true);

        const res  = await fetch(ENDPOINT, {
          method:'POST',
          headers:{ 'Accept':'application/json', 'Content-Type':'application/json' },
          body: JSON.stringify(data)
        });
        const json = await res.json();

        if (json && json.ok) {
          setText(msg,false,'已提交！我们将尽快处理。'); msg.className='msg msg--ok';
        } else {
          setText(msg,false,'提交失败，请稍后重试'); msg.className='msg msg--error';
        }
      }catch(e){
        setText(msg,false,'网络异常，请稍后重试'); msg.className='msg msg--error';
      }finally{
        btn.disabled = false;
        show(msg,true);
      }
    });
  </script>
</body>
</html>
